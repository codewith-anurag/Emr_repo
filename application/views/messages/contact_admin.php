<style type="text/css">
.page-sidebar.chat_shift .wraplist li .title, .page-sidebar.collapseit .wraplist li .title, .page-sidebar.chat_shift .wraplist li .arrow, .page-sidebar.collapseit .wraplist li .arrow {
display: block;
position: absolute;
left: 0;
top: 38px;
font-size: 13px;
margin-left: 10px;
max-width: 139px;
word-break: break-word;
width: 63px;
white-space: break-spaces;
line-height: 17px;
}
.page-sidebar.collapseit .wraplist li a i.img {
float: left;
margin-top: 3px;
padding-left: 18px;
}
.page-sidebar.chat_shift .wraplist li:hover .title, .page-sidebar.collapseit .wraplist li:hover .title {
top: 30px;
}
.page-sidebar.chat_shift #main-menu-wrapper .wraplist li a, .page-sidebar.collapseit #main-menu-wrapper .wraplist li a {
padding-left: 0px;
margin-bottom: 33px;
}
.page-sidebar.chat_shift .wraplist li:hover .title, .page-sidebar.collapseit .wraplist li:hover .title {
top: 40px;
}
.page-sidebar {
width: 180px;
}
#main-content {
margin-left: 165px;
}
.page-sidebar.chat_shift .wraplist li, .page-sidebar.collapseit .wraplist li {
position: relative !important;
bottom: 18px;
}
.page-sidebar {
height: auto;
width: 260px;
position: fixed;
padding: 0px;
background-color: #ffffff;
margin-top: 60px;
overflow: hidden;
box-shadow: 0 0 0px 0 rgba(33,33,33,.2) !important;
}
.sidebar-li{
border-bottom: 2px #eee solid;
}
#main-menu-wrapper li a:hover {
background-color: #d5f3f2;
border-left: 4px solid #4d9cf8;
color: #00b3ac;
}
#main-menu-wrapper li a:hover {
color: #150aec;
font-weight: 800;
}
.text-primary:hover {
color: #150aec;
font-weight: 800;
}
.table>tbody>tr>td:hover {
font-weight: 600;
}
#main-menu-wrapper li a {
color: #150aec;
}
.text-primary {
color: #150aec;
}
.page-sidebar.chat_shift .wraplist li .title, .page-sidebar.collapseit .wraplist li .title, .page-sidebar.chat_shift .wraplist li .arrow, .page-sidebar.collapseit .wraplist li .arrow {
display: block;
position: absolute;
left: 0;
top: 38px;
font-size: 13px;
margin-left: 5px;
max-width: 139px;
word-break: break-word;
width: 70px;
white-space: break-spaces;
line-height: 17px;
}
.page-sidebar.chat_shift .wraplist li:hover .title, .page-sidebar.collapseit .wraplist li:hover .title {
top: 30px;
}
.page-sidebar.chat_shift #main-menu-wrapper .wraplist li a, .page-sidebar.collapseit #main-menu-wrapper .wraplist li a {
padding-left: 0px;
margin-bottom: 33px;
}
.page-sidebar.chat_shift .wraplist li:hover .title, .page-sidebar.collapseit .wraplist li:hover .title {
top: 40px;
}
.page-sidebar {
width: 190px !important;
}
#main-content {
margin-left: 165px;
}
.page-sidebar.collapseit {
width: 60px !important;
}
.p-t-10 {
padding: 10px 0px 0px 0px;
}
.p-0 {
padding:0px;
}
.page-sidebar {
height: auto;
width: 260px;
position: fixed;
padding: 0px;
background-color: #ffffff;
margin-top: 60px;
overflow: hidden;
box-shadow: 0 0 0px 0 rgba(33,33,33,.2) !important;
}
.sidebar-li{
border-bottom: 2px #eee solid;
}
#main-menu-wrapper li a:hover {
background-color: #d5f3f2;
border-left: 4px solid #4d9cf8;
color: #00b3ac;
}
#main-menu-wrapper li a:hover {
color: #150aec;
font-weight: 800;
}
.text-primary:hover {
color: #150aec;
font-weight: 800;
}
.table>tbody>tr>td:hover {
font-weight: 600;
}
#main-menu-wrapper li a {
color: #150aec;
}
.text-primary {
color: #150aec;
}
.active .modal-content {
border-radius: 16px;
box-shadow: 2px 14px 16px -3px #5a5a5a;
}
.active .modal-body h4 {
padding-top: 20px;
font-weight: 700;
color: #150aec;
}
.active .modal-body span {
padding-top: 10px;
}
.table>tbody>tr>td:hover {
font-weight: 600;
}
.delete .modal-content {
border-radius: 15px;
}
.delete .modal-title  {
color: #150aec;
font-size: 18px;
font-weight: 700;
}
.delete .modal-body p {
color: red;
font-weight: 700;
}
.delete .modal-body {
padding: 20px;
}
.text-primary .color-black {
color: #848484;
font-size: 15px;
}
.light-grey {
color: #a9a9a9;
padding-right: 10px;
font-weight: 600;
}
.ml-15 {
margin-left: 15px;
}
.pt-15 {
padding-top: 15px !important;
}
.p-0 {
padding: 0px;
}
.border-right {
border-right: 1px solid #ccc;
}
section header {
border:none !important;
border-bottom: 1px solid #ccc !important;
margin-bottom: 10px;
background: #efefef !important;
min-height: 0px;
padding-left: 5px !important;
}
.insurance {
position: relative;
left: 13px;
top: 18px;
}
.pos-icon {
display: flex;
position: absolute;
right: 15px;
bottom: 13px;
}
.w-100 {
width: 100%;
}
.imp-red {
color: red;
}
.page-sidebar.chat_shift .wraplist li .title, .page-sidebar.collapseit .wraplist li .title, .page-sidebar.chat_shift .wraplist li .arrow, .page-sidebar.collapseit .wraplist li .arrow {
display: block;
position: absolute;
left: 0;
top: 38px;
font-size: 13px;
margin-left: 5px;
max-width: 139px;
word-break: break-word;
width: 70px;
white-space: break-spaces;
line-height: 17px;
}
.page-sidebar.chat_shift .wraplist li:hover .title, .page-sidebar.collapseit .wraplist li:hover .title {
top: 30px;
}
.page-sidebar.chat_shift #main-menu-wrapper .wraplist li a, .page-sidebar.collapseit #main-menu-wrapper .wraplist li a {
padding-left: 0px;
margin-bottom: 33px;
}
.page-sidebar.chat_shift .wraplist li:hover .title, .page-sidebar.collapseit .wraplist li:hover .title {
top: 40px;
}
.page-sidebar {
width: 180px;
}
#main-content {
margin-left: 165px;
}
.insurance-table thead {
color: #000;
background: #ccc;
font-size: 12px;
}
.m-0 {
margin: 0px;
}
.msg-list-box {
width: 100%;
}
.msg-list-box {
width: 100%;
background: #4d90e5;
padding: 8px;
}
.msg-list-box span {
color: #fff;
}
.msg-lists ul {
padding-left: 0px;
list-style-type: none;
}
.msg-lists ul li {
color: #000000;
border-bottom: 1px solid #d0d0d0;
padding: 9px 7px;
}
.msg-lists ul li a {
display: inline;
}
.msg-lists img {
width: 7.6%;
height: 20px;
margin-bottom: 8px;
}
.msg-lists li span {
padding-left: 10px;
}
.msg-lists ul li a {
color: #0cd8d3;
font-size: 14px;
}
.msg-lists ul li a:hover {
color: #0cd8d3;
font-weight: 600;
}
.msg-lists ul li:last-child {
border-bottom: none;
}
.pl-27 {
padding-left: 27px;
}
.p-right-top {
padding-right: 25px;
padding-top: 10px;
}
.serch-msg {
float: right;
position: relative;
bottom: 25px;
right: 9px;
}
textarea {
border-radius: 5px;
}
textarea:focus {
background: #f8f8f8;
border-color: #4d9cf8;
outline: 0;
-webkit-box-shadow: none;
-moz-box-shadow: none;
box-shadow: none;
}
/*.white-box {
background: #fff;
border-radius: 5px;
padding: 10px;
margin-right: 10px;
box-shadow:0px 5px 10px 0px #ececec;
margin-bottom: 35px;
}*/
.border-top {
border-top: 1px solid #ccc;
margin-top: 10px;
}
table thead {
background: #f5f5f5 ;
color: #404040;
}
.ml-015 {
margin-left: -15px;
}
.table td a {
font-size: 14px;
position: relative;
bottom: 5px;
}
table td {
border-right: 1px solid #d6d6d6;
}
table th {
color: #5785e8;
border-right: 1px solid #d6d6d6;
border-color: #d6d6d6 !important;
}
.hovertr:hover {
background-color: #d5f3f2;
}
.brder-left {
border-left: 1px solid #ccc;
height:auto;
}
.nav-tabs {
padding-bottom: 8px;
}
.nav-tabs>li.active>a, .nav-tabs>li.active>a:hover, .nav-tabs>li.active>a:focus {
background: transparent;
border: none;
border-bottom: 3px solid #150aec;
color: #150aec;
font-weight: 700;
}
.nav-tabs {
padding-bottom: 0px;
}
.nav-tabs>li>a {
border: none;
background: transparent;
color: #150aec;
}
.nav>li>a:hover, .nav>li>a:focus {
border-bottom: 3px solid #150aec;
color: #150aec;
font-weight: 700;
background: transparent;
}
.tab-list.nav-tabs {
border-bottom: none;
}
.bttom-brder {
border-bottom: 1px solid #ccc;
padding-bottom: 50px;
}
.ml-25 {
margin-left: 25px;
}
.right-0 {
position: absolute;
right: 0px;
margin-right: 12px;
margin-top: 7px;
top:15px;
}
.tab-content  {
padding: 0px;
}
.msg-lists .badge {
padding: 5px 8px;
border-radius: 50%;
background-color: #150aec;
color: white;
float: right;
cursor: pointer;
}
.modal-content h4 {
color: #150aec;
font-weight: 700;
}
.modal-content {
border-radius: 15px !important;
}
.tab-content {
border: none;
}
.msg-lists  .nav>li>a {
padding: 7px;
}
.msg-lists .nav-tabs>li.active>a, .nav-tabs>li.active>a:hover, .nav-tabs>li.active>a:focus {
border-bottom:none;
color: #0cd8d3;
}
.msg-lists .nav>li>a:hover, .nav>li>a:focus {
border-bottom: none;
}
.readm{
font-weight: 600;
background-color: #d5f3f2;
}
.m-10 {
margin:10px !important;
}
.heading-patient h4  {
color: #150aec;
font-weight: 700;
border-bottom: 1px solid #cccc;
padding-bottom: 12px;
text-transform: uppercase;
padding-left: 10px;
}
.m-0 {
margin:0px;
}
.m-0-auto {
display: flex;
justify-content: center;
margin: 30px 0px;
}
/* message window */


.incoming_msg_img {
  display: inline-block;
  width: 6%;
}
.received_msg {
  display: inline-block;
  padding: 0 0 0 10px;
  vertical-align: top;
  width: 92%;
 }
 .received_withd_msg p {
  background: #ebebeb none repeat scroll 0 0;
  border-radius: 3px;
  color: #646464;
  font-size: 14px;
  margin: 0;
  padding: 5px 10px 5px 12px;
  width: 100%;
}
.time_date {
  color: #747474;
  font-size: 12px;
  margin: 0px 0 8px;
  display: inline-block;
}
.attachement_sc{
    display: inline-block;
    float: right;
  }
.received_withd_msg { width: 70%;}
.mesgs {
  float: left;
  width: 100%;
}

 .sent_msg p {
  background: #05728f none repeat scroll 0 0;
  border-radius: 3px;
  font-size: 14px;
  margin: 0; color:#fff;
  padding: 5px 10px 5px 12px;
  width:100%;
}
.outgoing_msg{ overflow:hidden; margin:10px 0 10px;}
.sent_msg {
  float: right;
  width: 70%;
}
.input_msg_write input {
  background: rgba(0, 0, 0, 0) none repeat scroll 0 0;
  border: medium none;
  color: #4c4c4c;
  font-size: 15px;
  min-height: 48px;
  width: 100%;
}

.type_msg {border-top: 1px solid #c4c4c4;position: relative;}
.msg_send_btn {
  background: #05728f none repeat scroll 0 0;
  border: medium none;
  border-radius: 50%;
  color: #fff;
  cursor: pointer;
  font-size: 17px;
  height: 33px;
  position: absolute;
  right: 0;
  top: 11px;
  width: 33px;
}
.messaging { padding: 0 0 50px 0;}

/* message window */
</style>
<div class="clearfix"></div>
<div class="col-lg-12 white-box" style="width: 100%;margin-right: 2%;min-height: 850px;">
  <section class="box">
    <table class="table" style="border-bottom: 0.5px solid #c6c4c1; display:table;">
      <tbody>
        <tr>
          <td width="30%">
            <a href="javascript:void(0)" data-toggle="modal" data-target="#newMessagebox" class="btn btn-default" style="margin-right:10px;">New Message</a>
          </td>
          <td>
            <div style="position: absolute;right:calc(100% - 33%); /*left: 1em; top: 0;*/ padding-top: 7px;" > <span id="searchButtonShow" class="text-primary hover icon-md fa fa-search" aria-hidden="true"  style="margin-left: 1px;"></span>
            </div>
            <input onkeyup="message_search()" id="message_searchdata" style="padding-left: 3em; padding-right: 3em; width: 100%; height: 100%; padding-bottom: 4px; padding-top: 8px; border: 1px solid #f7f8f9;" maxlength="100" class="form-control" placeholder="Search message by email" title="Search message by email" >
          </td>
        </tr>
      </tbody>
    </table>
    <style>
        .hovertr:hover{
           background-color: #d5f3f2;
        }
    </style>
    <div class="col-lg-12" style="min-height: 850px;">
      <table class="table table-patient" style="display:table;">
        <thead>
          <tr>

            <th>From Email</th>
            <th width="10%" >Subject</th>
            <th class="text-center">Message</th>
            <th class="text-center">Action</th>

          </tr>
        </thead>
        <tbody id="suMsaages">

          <?php
          if (!empty($all_message)) { ?>
            <?php $sl = 1;
              //print_r($_SESSION);

            ?>
            <?php foreach ($all_message as $patient) {

              //var_dump($all_message);
              $read = $this->db->select("*")->from("contact_super_admin")->where("to_email_address",$_SESSION['email'])->where('is_read','0')->order_by('date','DESC')->get()->result();
              //  $reads = $this->db->select("*")->from("contact_super_admin")->where("to_email_address",$_SESSION['email'])->where('is_read','0')->order_by('date','DESC')->get()->row();
             ?>
              <tr style="border-bottom: 1px solid #ddd;" class="hovertr <?php echo(count($read)>0)?'readm':''; ?>" >
                <td ><span class="text-primary"><?php echo $patient->from_email_address; ?></span></td>
                <td><?php echo $patient->subject; ?></td>
                <td><?php echo $patient->message; ?> </td>
               <td class="pt-15"><div class="btn-group" style="float: right;display: flex;">
                  <a href="#" data-toggle="modal" data-target="#MessageDetails" onclick="GetAllUserMassages('<?php echo $patient->from_user_id; ?>')" class="btn btn-xs icon-box" style="margin-right:10px;"><i class="fa fa-eye"></i></a>
                  <?php  /*<a href="#" id="reply_to_user" class="btn btn-xs btn-default" style="margin-right:10px;" onClick="getUserEmailId('<?php echo $patient->from_email_address;?>','<?php echo $patient->from_user_id; ?>')" data-toggle="modal" data-target="#forwrdbox"><i class="fa fa-share"></i></a>
                  <a href="<?php echo base_url("dashboard_super/messages/message/delete/$patient->contact_id") ?>" class="btn btn-xs btn-danger icon-box" onclick="return confirm('<?php  echo display('are_you_sure') ?>')"><i class="fa fa-trash"></i></a>
                </div>*/ ?>
              </td>
              </tr>


          <?php $sl++; ?>
                            <?php } ?>
                        <?php } ?>
        </tbody>
      </table>

    </div>
  </section>
</div>
<div class="clearfix"></div>
<!-- <div class="col-lg-12 white-box" style="width: 100%;margin-right: 2%;min-height: 850px;" >
  <section  class="box nobox marginBottom0">
    <div class="content-body">
      <form action="<?php //echo base_url(); ?>messages/message/new_message_admin" class="form-inner" enctype="multipart/form-data" method="post" accept-charset="utf-8">
        <div class="clearfix"></div>
        <div class="row m-0">
          <div class="col-12 heading-patient">
            <h4>Contact To Support </h4>
          </div>
        </div>
        <div class="row  m-10">
          <div class="col-12 col-md-12 form-group">
            <label>TO</label>
            <?php $patient_drop = $this->db->select("*")->from("user")->where("user_role",'11')->where("status",'1')->get()->row();  ?>
            <input type="email" name="to_email_address" required class="form-control text-field" value="<?php echo $patient_drop->email; ?>" id="Prefix">
            <input type="hidden" name="to_user_id" required class="form-control text-field" value="<?php echo $patient_drop->user_id; ?>" id="Prefix">
          </div>
          <div class="col-12 col-md-12 form-group">
            <label>FROM</label>
            <input type="email" name="from_email_address" required class="form-control text-field" value="<?php echo $this->session->userdata('email'); ?>" id="Prefix">
            <input type="hidden" name="from_user_id" required class="form-control text-field" value="<?php echo $this->session->userdata('user_id'); ?>" id="Prefix">
          </div>
          <div class="col-12  col-md-12 form-group">
            <label>SUBJECT</label>
            <input type="text" name="subject" required class="form-control text-field" value="" id="Prefix">
          </div>
          <div class="col-12 col-md-12 form-group">
            <label>MESSAGE</label>
            <textarea class="w-100" id="notes" required name="message" rows="5"></textarea>
          </div>
        </div>
        <input type="hidden" name="<?php echo $this->security->get_csrf_token_name();?>" value="<?php echo $this->security->get_csrf_hash();?>">
        <div class="m-0-auto">
          <button type="submit" class="btn btn-default" style="margin-right:10px;">Send Message</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
  </section>
</div> -->
<div class="modal fade" id="newMessagebox" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span>
        </button>
        <h4 class="modal-title" id="myModalLabel" style="color:#150aec;font-weight:700;">Contact To Support  </h4>
      </div>
    <form action="<?php echo base_url(); ?>messages/message/new_message_admin" class="form-inner" enctype="multipart/form-data" method="post" accept-charset="utf-8">
       <div class="modal-body">
        <div class="clearfix"></div>
        <div class="row  m-10">
          <div class="col-12 col-md-12 form-group">
            <label>TO</label>
            <?php $patient_drop = $this->db->select("*")->from("user")->where("user_role",'11')->where("status",'1')->get()->row();  ?>
            <input type="email" name="to_email_address" required class="form-control text-field" value="<?php echo $patient_drop->email; ?>">
            <input type="hidden" name="to_user_id" required class="form-control text-field" value="<?php echo $patient_drop->user_id; ?>" >
          </div>
          <div class="col-12 col-md-12 form-group">
            <label>FROM</label>
            <input type="email" name="from_email_address" required class="form-control text-field" value="<?php echo $this->session->userdata('email'); ?>" >
            <input type="hidden" name="from_user_id" required class="form-control text-field" value="<?php echo $this->session->userdata('user_id'); ?>" >
          </div>
          <div class="col-12  col-md-12 form-group">
            <label>SUBJECT</label>
            <input type="text" name="subject" required class="form-control text-field" value="" >
          </div>
          <div class="col-12 col-md-12 form-group">
            <label>MESSAGE</label>
            <textarea class="w-100" id="notes" required name="message" rows="5"></textarea>
          </div>
          <div class="col-12 col-md-12 form-group">
            <label>UPLOAD SCREENSHOT</label>
            <input type="file" class="form-control" name="file" onchange="document.getElementById('upload_image').src = window.URL.createObjectURL(this.files[0])">

            <img src="<?php echo base_url('assets/images/transparent.png');?>" id="upload_image" style="max-width: 100px; margin-top: 15px;">
          </div>
        </div>
      </div>
        <input type="hidden" name="<?php echo $this->security->get_csrf_token_name();?>" value="<?php echo $this->security->get_csrf_hash();?>">
        <div class="m-0-auto">
          <button type="submit" class="btn btn-default" style="margin-right:10px;">Send Message</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>
<div class="modal fade" id="MessageDetails" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" onclick="refresh();" aria-label="Close"><span aria-hidden="true">×</span>
        </button>
        <h4 class="modal-title" id="MessageDetails" style="color:#150aec;font-weight:700;">Reply Message Detail </h4>
      </div>
      <div class="modal-body" style="height: 500px;">
         <div class="mesgs">
          <div class="msg_history">
          </div>
        </div>
        </div>
        <div class="clearfix"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" onclick="refresh();">Close</button>
        </div>
    </div>
  </div>
</div>
<style type="text/css">

</style>
<script type="text/javascript">
function GetAllUserMassages(from_id){
  $(".msg_history").empty();
  var txt ='';
  $.ajax({
       type: 'POST',
       url:'<?=base_url()?>messages/message/getAllMsgData',
       data: {
          'from_user_id': from_id,
          '<?php echo $this->security->get_csrf_token_name(); ?>':'<?php echo $this->security->get_csrf_hash(); ?>',
        },
       dataType: 'json',
       success: function(response){
        $.each(response.msg, function(index,value) {
          var attachement_sc = '';
          if(response.msg[index].file){
          attachement_sc = '<a href="<?php echo base_url()?>'+response.msg[index].file+'" target="_blank" class="attachement_sc"><i class="fa fa-paperclip" aria-hidden="true"></i><a>';
          }

          if(response.msg[index].type == 1){
            txt = '<div class="outgoing_msg"><div class="sent_msg"><p><span class="small">Subject: '+response.msg[index].subject+'</span><br>Message: '+response.msg[index].message+'</p><span class="time_date"> '+response.msg[index].date+'</span>'+attachement_sc+' </div>';
          }
          if(response.msg[index].type == 2){
            txt = '<div class="incoming_msg"><div class="received_msg"><div class="received_withd_msg"><p><span class="small">Subject: '+response.msg[index].subject+'</span><br>Message: '+response.msg[index].message+'</p><span class="time_date"> '+response.msg[index].date+'</span>'+attachement_sc+'</div></div></div>';
          }
          // console.log(txt);
          $('.msg_history').append(txt);
        })
        contact_read(from_id);
     }

 });
}
</script>
